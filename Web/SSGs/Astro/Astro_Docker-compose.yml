
services:
  # Astro Development Server
  astro-dev:
    image: node:22.16-alpine3.22 #node:18-alpine
    container_name: astro-dev
    working_dir: /app
    ports:
      - "4324:4321"  # Astro dev server with live changes port - Go to http://localhost:4324/
    volumes:
      - ./:/app #this is a common volume for Codex container to place the .md post
    command: sh -c "cd /app && npm install && npm run dev -- --host 0.0.0.0"
    environment:
      - NODE_ENV=development
    networks:
      - project-network
    tty: true
    restart: "no"

  astro-prod:
    image: node:22.16-alpine3.22 #node:18-alpine #docker pull node:22.16-alpine3.22
    container_name: astro-prod
    working_dir: /app
    volumes:
      - ./:/app #this is a common volume for Codex container to place the .md post
    ports:
      - "8087:4321"  # Changed to match Astro's default port
    command: >
      sh -c "cd /app && 
      npm install && 
      npm run build && 
      npx http-server ./dist -p 4321"
    environment:
      - NODE_ENV=production
    networks:
      - project-network
    restart: "no"

networks:
  project-network:
    name: project-documentation-network


# version: '3.8'

# services:
#   astro-dev:
#     image: astro_ssg:latest
#     container_name: web-astro    
#     ports:
#       - "4321:4321"
#     volumes:
#       - app_data:/usr/src/app
#       - node_modules:/usr/src/app/node_modules
#     environment:
#       - NODE_ENV=development
#     command: npm run dev #tail -f /dev/null #keep it running      

# volumes:
#   node_modules:
#   app_data:

# #### docker build -t astro_ssg -f Dockerfile .

# #docker exec -it web-astro sh
